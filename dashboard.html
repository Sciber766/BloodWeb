<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BloodWeb</title>
    <link rel="icon" href="BloodWeb.jpeg">
    <link rel="stylesheet" href="dashboard.css">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
    <div class="box">
        <header class="flex justify-between">
            <div class="logo"><a href="#"><img class="h-[40px]" src="Untitled_design-removebg-preview.png" alt="BloodWeb"></a></div>
            <nav class="block md:hidden"><i class="fa-solid fa-bars"></i></nav>
        </header>
        <div id="requestFormContainer" class="popup hidden">
            <form id="requestForm">
            <div class="detailhead">New Blood Request</div>
            <label for="bloodGroup">Blood Group</label>
            <select id="bloodGroup" name="bloodGroup" required>
            <option value="">Select</option>
            <option value="A+">A+</option>
            <option value="A-">A-</option>
            <option value="B+">B+</option>
            <option value="B-">B-</option>
            <option value="AB+">AB+</option>
            <option value="AB-">AB-</option>
            <option value="O+">O+</option>
            <option value="O-">O-</option>
            </select>
          
              <label>Urgency (1-5):</label>
              <input type="number" name="urgency" min="1" max="5" required><br>
          
              <label>Location:</label>
              <input type="text" name="location" required><br>
          
              <button type="submit">Submit</button>
              <button type="button" id="cancelForm">Cancel</button>
            </form>
          </div>
          <!-- Edit Sidebar -->
        <div id="editSidebar" class="sidebar">
            <div class="sidebar-header">
                <div class="detailhead md:text-sm lg:text-base"></i>EDIT DETAILS</div>
                <button id="closeSidebar" class="post Dedit">&times;</button>
            </div>
            <form id="editForm">
            <button type="submit">Save Changes</button>
            </form>
        </div>
        <div id="notificationPanel" class="notification-panel card">
            <div class="detailhead notificationHead">NOTIFICATIONS</div>
            <ul id="notificationList" class="notificationList">
                <!-- Notifications will be appended here -->
            </ul>
        </div>
        
        <div class="rightEdit"></div>
        <div class="innerBox">
            <div class="Left">
                <div class="topLeft">
                    <div class="bloodDetail card relative">
                        <div class="header">
                            <i class="fa-solid fa-droplet"></i>
                            <div class="detailhead md:text-sm lg:text-base"></i>BLOOD DETAILS</div>
                        </div>
                        <div class="details">
                            <div class="bullet Bd"><span class="Bname">Blood group</span><span class="point" id="Bgroup"></span></div>
                            <div class="bullet Bd"><span class="Bname">Status</span><span class="point" id="DonationStatus"></span></div>
                            <div class="bullet Bd"><span class="Bname">Last donation</span><span id="DOB"></span></div>
                            <div class="bullet Bd"><span class="Bname">Donor status</span><span id="DonorType"></span></div>
                        </div>
                    </div>
                    <div class="topRight">
                        <div class="bloodRequest card">
                            <div class="detailhead md:text-sm lg:text-base">BLOOD REQUESTS</div>
                            <div class="requestSection detailhead">
                                <div id="requests" class="requests flex w-[95%] h-full m-[8px]">

                                </div>
                                <div class="writeReq">
                                    <!-- <div class="postReq detailhead"><input type="text" name="request" id="request" placeholder="Write something"></div> -->
                                    <button class="post" id="openForm"><i class="fa-solid fa-plus"></i></button>
                                </div>
                            </div>
                            
                            
                        </div>
                        <div class="requestBlood card">
                            <div class="emergencyReq detailhead"></div>
                        </div>
                    </div>
                </div>
                <div class="bottomLeft">
                    <div class="recentDonation card">
                        <div class="detailhead">RECENT DONATION</div>
                        <div id="recentDonation" class="requests flex w-[95%] h-[75%] m-[8px]">

                        </div>
                    </div>
                    <div class="emergency card relative">
                        <div class="detailhead">EMERGENCY DETAILS</div>
                        <div class="flex flex-col gap-2">
                            <div class="bullet ED"><span class="Bname">Mobile</span><span id="phone"></span></div>
                            <div class="bullet ED"><span class="Bname">Email</span><span id="email"></span></div>
                            <div class="bullet ED"><span class="Bname">Availability</span><span id="status"></span></div>
                        </div>
                        <div class="absolute right-1 bottom-1">
                            <button id="editEmergencyDetails" class="post Dedit"><i class="fa-solid fa-pen-to-square"></i></button>
                        </div>

                    </div>
                </div>
            </div>
            <div class="Right">
                <div class="profileSection card">
                    <div id="name" class="name detailhead md:text-lg lg:text-xl"></div>
                    <div class="proContainer">
                        <div class="detContainer">
                            <div class="ageInfo bullet"><span id="age"></span><span id="gender"></span></div>
                            <div id="location" class="bullet"></div>
                            <div class="heartContainer">
                                <button class="status"><i class="fa-solid fa-heart"></i></button>
                                <div class="ecg">
                                    <svg class="ecg-line" viewBox="100 11 120 80">
                                        <path d="M 0 50 L 50 50 L 60 20 L 70 80 L 80 50 L 150 50 L 160 20 L 170 80 L 180 50 L 250 50" 
                                          stroke="" fill="transparent" stroke-width="2.5" stroke-linejoin="round"/>
                                    </svg>                        
                                </div>
                            </div>
                        </div>
                        <div class="profileContainer items-center">
                            <div id="profile" class="flex items-center justify-center w-28 h-28 overflow-hidden rounded-full border border-[#ff00004d] shadow-[0_1px_5px_rgba(255,0,0,0.3)]">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="fill-[#47474a] bg-[#7d7d80]"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M399 384.2C376.9 345.8 335.4 320 288 320l-64 0c-47.4 0-88.9 25.8-111 64.2c35.2 39.2 86.2 63.8 143 63.8s107.8-24.7 143-63.8zM0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256zm256 16a72 72 0 1 0 0-144 72 72 0 1 0 0 144z"/></svg>
                            </div>
                            <div class="buttonHold">
                                <button class="post logout">Logout <i class="fa-solid fa-right-from-bracket"></i></button>
                                <button id="editProfile" class="post Dedit"><i class="fa-solid fa-pen-to-square"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="iconSection card">
                    <button class="post toggles avButton"><span class="material-symbols-outlined">bloodtype</span></button>
                    <button class="post toggles emergencyButton"><span class="material-symbols-outlined">emergency_home</span></button>
                    <button class="post toggles active notification"><i class="fa-solid fa-bell"></i></button>
                </div>
                <div class="timerSection card">
                    
                </div>
            </div>
        </div>
        
    </div>
    <script>
        const token = localStorage.getItem('token');
      
        if (!token) {
          alert('You must be logged in to access the dashboard.');
          window.location.href = 'login.html';
        }
      
        // Optional: verify token with backend
        fetch('https://bloodweb-dbackend.onrender.com/api/auth/verify', {
          method: 'GET',
          headers: {
            'Authorization': 'Bearer ' + token
          }
        })
        .then(res => {
          if (!res.ok) {
            alert('Session expired. Please log in again.');
            localStorage.removeItem('token');
            window.location.href = 'login.html';
          }
          return res.json();
        })
        .then(data => {
          console.log('User verified:', data);
          // Fill other values as needed
        })
        .catch(err => {
          console.error('Token verification failed:', err);
          window.location.href = 'login.html';
        });
      </script>
      
    <script src="script.js">
    </script>
</body>
</html>